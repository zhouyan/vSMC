<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>vSMC: Generating random numbers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">vSMC
   </div>
   <div id="projectbrief">Vectorized Sequential Monte Carlo</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Generating random numbers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>The problem</h2>
<p>The <a href="http://www.thesalmons.org/john/random123/releases/latest/docs/index.html">Random123</a> library is ideal for generating random numbers on OpenCL device. It is easy to use, for example, say inside a kernel, to generate four standard normal random variates, </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Random123/threefry64.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vsmc/opencl/u01.h&gt;</span></div>
<div class="line"></div>
<div class="line">threefry4x32_ctr_t c = {{}};</div>
<div class="line">threefry4x32_key_t k = {{}};</div>
<div class="line">k.v[0] = get_global_id(0);</div>
<div class="line">c.v[0] = iter; <span class="comment">// some iteration number change between kernel calls.</span></div>
<div class="line">threefry4x32_ctr_t r = threefry4x32(c, k);</div>
<div class="line"><span class="keywordtype">float</span> u[4];</div>
<div class="line"><span class="keywordtype">float</span> z[4];</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i != 4; ++i)</div>
<div class="line">    u[i] = <a class="code" href="group___r_n_g.html#gab471f6000c4fb886616540450aab7643">u01_open_closed_32_24</a>(r.v[i]);</div>
<div class="line">z[0] = sqrt(-2 * log(u[0])) * cos(2 * M_PI_F * u[1]);</div>
<div class="line">z[1] = sqrt(-2 * log(u[0])) * sin(2 * M_PI_F * u[1]);</div>
<div class="line">z[2] = sqrt(-2 * log(u[2])) * cos(2 * M_PI_F * u[3]);</div>
<div class="line">z[3] = sqrt(-2 * log(u[2])) * sin(2 * M_PI_F * u[3]);</div>
</div><!-- fragment --><p> As seen above, for every call to <code>threefry4x32</code> we can generate four standard normal random variates. It is fine if we just happen to need four random numbers. But this is rarely the case. Then we need some tricky code to keep track of when to call <code>threefry4x32</code> again etc., or call it every time we need a random number and waste a lot of time and generated numbers.</p>
<p>vSMC's RNG module provide some facilities to partially solve this problem.</p>
<p>#</p>
<h1>RNG engines</h1>
<div class="fragment"><div class="line">&lt;vsmc/opencl/urng.h&gt;</div>
</div><!-- fragment --><p> The counter-based RNGs are wrapped in the above header. Eight are defined, </p>
<div class="fragment"><div class="line"><a class="code" href="structthreefry2x32__rng__t.html">threefry2x32_rng_t</a></div>
<div class="line"><a class="code" href="structthreefry4x32__rng__t.html">threefry4x32_rng_t</a></div>
<div class="line"><a class="code" href="structthreefry2x64__rng__t.html">threefry2x64_rng_t</a></div>
<div class="line"><a class="code" href="structthreefry4x64__rng__t.html">threefry4x64_rng_t</a></div>
<div class="line"><a class="code" href="structphilox2x32__rng__t.html">philox2x32_rng_t</a></div>
<div class="line"><a class="code" href="structphilox4x32__rng__t.html">philox4x32_rng_t</a></div>
<div class="line"><a class="code" href="structphilox2x64__rng__t.html">philox2x64_rng_t</a></div>
<div class="line"><a class="code" href="structphilox4x64__rng__t.html">philox4x64_rng_t</a></div>
</div><!-- fragment --><p> The default engines use <code>threefry4x32</code> etc. To use the Philox engine, define macros <code>CBRNG4x32</code> <em>and</em> <code>CBRNG4x32KEYINIT</code> etc., before including vSMC headers. For example, </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define CBRNG4x32 philox4x32</span></div>
<div class="line"><span class="preprocessor">#define CBRNG4x32KEYINIT philox4x32keyinit</span></div>
</div><!-- fragment --><p>Each RNG engine is used as the following, </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;vsmc/opencl/urng.h&gt;</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="structthreefry4x32__rng__t.html">threefry4x32_rng_t</a> rng;</div>
<div class="line"><a class="code" href="group___r123_r_n_g.html#gabe023c9602612d112f833821b898a7e7">threefry4x32_init</a>(&amp;rng);</div>
<div class="line">uint32_t res = <a class="code" href="group___r123_r_n_g.html#ga20b50309ed74122b1574f7a17d01fd90">threefry4x32_rand</a>(&amp;rng);</div>
</div><!-- fragment --><p> The function <code>threefry4x32_rand</code> will be responsible for increasing the counters. The keys and counters can also be set manually. For example, </p>
<div class="fragment"><div class="line">rng.<a class="code" href="structthreefry4x32__rng__t.html#a64e6bf5517153bef189b7240f0d5c868">key</a>.v[0] = get_global_id(0);</div>
<div class="line">rng.<a class="code" href="structthreefry4x32__rng__t.html#a6622176b4cdff6991a3a748f611c08be">ctr</a>.v[0] = 0;</div>
</div><!-- fragment --><p>One may keep the states of counters between OpenCL kernel calls as in the following example, </p>
<div class="fragment"><div class="line">__kernel <span class="keywordtype">void</span> ker (__global <span class="keyword">struct</span> threefry4x32_ctr_t *counter)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="structthreefry4x32__rng__t.html">threefry4x32_rng_t</a> rng;</div>
<div class="line">    <a class="code" href="group___r123_r_n_g.html#gabe023c9602612d112f833821b898a7e7">threefry4x32_init</a>(&amp;rng, get_global_id(0));</div>
<div class="line">    rng.<a class="code" href="structthreefry4x32__rng__t.html#a6622176b4cdff6991a3a748f611c08be">ctr</a> = counter[get_global_id(0)];</div>
<div class="line">    <span class="comment">// use engine rng</span></div>
<div class="line">    counter[i] = rng.<a class="code" href="structthreefry4x32__rng__t.html#a6622176b4cdff6991a3a748f611c08be">ctr</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p> Since OpenCL does not support static local variables, this is the most convenient way to ensure that the RNG used in each kernel call does not overlap their counters.</p>
<h2>Distributions</h2>
<h3>Overview</h3>
<p>For each distribution, a set of types and functions are defined. Each of them use either 32- or 64-bits RNG and generate <code>float</code> or <code>double</code> precision results. For example, </p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> <a class="code" href="group___r_n_g.html#gab471f6000c4fb886616540450aab7643">u01_open_closed_32_24</a> (uint32_t);</div>
</div><!-- fragment --><p> generate <code>float</code> precision uniform random variates on <code>(0, 1]</code> using 32-bits integers. Another example, </p>
<div class="fragment"><div class="line"><a class="code" href="structnormal01__4x32__24.html">normal01_4x32_24</a></div>
</div><!-- fragment --><p> is the type used to construct objects that can be used to generate <code>float</code> precision standard Normal random variates using <code>threefry4x32</code> engines.</p>
<p>Not all OpenCL devices have <code>double</code> precision support. Therefore by default, only 32-bits and <code>float</code> versions of these types and functions are defined. To enable 64-bits and <code>double</code> versions, define the macro <code>VSMC_FP_TYPE_IS_DOUBLE</code> with a non-zero value.</p>
<p>In a single program, usually only <code>float</code> or <code>double</code> precision is used. Macros are defined according to the value of <code>VSMC_FP_TYPE_IS_DOUBLE</code>. For example, </p>
<div class="fragment"><div class="line"><a class="code" href="normal01_8h.html#a35b638f77993054aa5422bd32aeba4f5">NORMAL01_4x32</a></div>
</div><!-- fragment --><p> is the type used to construct objects that can be used to generate standard Normal random variates using <code>threefry4x32</code> engines. The generated results is <code>double</code> if <code>VSMC_FP_TYPE_IS_DOUBLE</code> is defined and non-zero or <code>float</code> otherwise.</p>
<p>In the documentation of each distribution, the following notations are used,</p>
<ul>
<li><code>&lt;N&gt;</code>: 2 or 4, the rounds of counter-based RNG algorithm</li>
<li><code>&lt;W&gt;</code>: 32 or 64, the bits of integer RNG</li>
<li><code>&lt;FT&gt;</code>: float or double</li>
<li><code>&lt;F&gt;</code>: 24 if <code>&lt;FT&gt;</code> is float, 53 if <code>&lt;FT&gt;</code> is double</li>
</ul>
<dl class="section see"><dt>See Also</dt><dd></dd></dl>
<p><a class="el" href="u01.html">Uniform real distribution</a></p>
<p><a class="el" href="normal01.html">Normal distribution</a></p>
<p><a class="el" href="gammak1.html">Gamma distribution</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
